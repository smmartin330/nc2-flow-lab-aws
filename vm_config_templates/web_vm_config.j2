#cloud-config
password: {{ vm_password }}
chpasswd: { expire: False }
ssh_pwauth: True
apt_update: True
packages:
 - apache2
 - php
 - php-mysql
 - mariadb-client
write_files:
 - content: |
    <?php
    define( 'DB_NAME', 'wordpress' );
    define( 'DB_USER', 'wp_admin' );
    define( 'DB_PASSWORD', '{{ vm_password }}' );
    define( 'DB_HOST', '{{ db_server_ip }}' );
    define( 'DB_CHARSET', 'utf8mb4' );
    define( 'DB_COLLATE', '' );
    define( 'AUTH_KEY',         '{{ wp_auth_key }}' );
    define( 'SECURE_AUTH_KEY',  '{{ wp_secure_auth_key }}' );
    define( 'LOGGED_IN_KEY',    '{{ wp_logged_in_key }}' );
    define( 'NONCE_KEY',        '{{ wp_nonce_key }}' );
    define( 'AUTH_SALT',        '{{ wp_auth_salt }}' );
    define( 'SECURE_AUTH_SALT', '{{ wp_secure_auth_salt }}' );
    define( 'LOGGED_IN_SALT',   '{{ wp_logged_in_salt }}' );
    define( 'NONCE_SALT',       '{{ wp_nonce_salt }}' );
    $table_prefix = 'wp_';
    define( 'WP_DEBUG', false );
    if ( ! defined( 'ABSPATH' ) ) {
      define( 'ABSPATH', __DIR__ . '/' );
    }
    require_once ABSPATH . 'wp-settings.php';
   path: /tmp/wp-config.php
runcmd: 
 - hostname {{ hostname }}
 - echo "<?php phpinfo(); ?> " > /var/www/html/info.php
 - cd /tmp && wget https://wordpress.org/latest.tar.gz
 - tar -xvf /tmp/latest.tar.gz
 - cp -R /tmp/wordpress /var/www/html
 - cp /tmp/wp-config.php /var/www/html/wordpress/
 - chown -R www-data:www-data /var/www/html/wordpress
 - chmod -R 755 /var/www/html/wordpress
 - mkdir /var/www/html/wordpress/wp-content/uploads
 - chown -R www-data:www-data /var/www/html/wordpress/wp-content/uploads/

